### **`DOC-GAMEPLAY-FUNFACTORS` (v1.1)**

# **ProjectAAA: 핵심 전투 재미 요소 기획서 (v1.1)**

## **1. 문서 개요**

| 항목 | 내용 |
| :--- | :--- |
| **문서 ID** | DOC-GAMEPLAY-FUNFACTORS |
| **문서명** | 핵심 전투 재미 요소 기획서 (Core Combat Fun Factors GDD) |
| **버전** | **1.1** |
| **담당자** | PM/AI |
| **목적** | `STAT`, `ITEM`, `SKIL` 등 모든 어빌리티 관련 시스템이 공통적으로 추구해야 할 **상위 전투 경험 목표**를 정의한다. 이 문서는 개별 시스템 기획의 상위 지침 역할을 한다. |
| **변경 이력**| **v1.1:** '3.4 창조의 완성: 동적 세트 시너지' 시스템 상세 명세 추가. |

## **2. 전투 경험 핵심 철학: "숙련이 보상받고, 창의성이 빛나는 전장"**

플레이어는 단순히 버튼을 누르는 기계가 되어서는 안 된다. 전투의 흐름을 읽고, 시스템의 규칙을 이해하며, 자신만의 방식으로 위기를 극복하는 과정에서 최고의 재미를 느껴야 한다. 이를 위해, 모든 전투 관련 시스템은 아래 3가지 핵심 재미 요소를 구현하는 것을 공동의 목표로 삼는다.

1.  **몰입의 가속 (Flow)**: 잘하고 있을 때, 더 잘하게 만들어주는 긍정적 강화.
2.  **연쇄의 발견 (Synergy)**: 숨겨진 규칙을 발견하고 조합하는 지적 유희.
3.  **역전의 한 방 (Climax)**: 작은 성공을 쌓아 폭발시키는 극적인 카타르시스.

## **3. 핵심 재미 요소 명세**

### **3.1 몰입의 가속: 스킬 ‘모멘텀(Flow) 버프’**

*   **기획 의도 (Why):** 전투의 '리듬'을 타는 경험을 제공한다. 플레이어가 연속적인 성공(공격 명중)을 통해 스스로 전투의 흐름을 가속시킬 때, 강력한 몰입감과 쾌감을 느끼게 한다.
*   **구현 명세 (What & How):**
    *   **스택 획득:** 스킬이 적에게 명중할 때마다 `Flow.Stack` 태그 스택을 1씩 획득한다. (최대 5스택)
    *   **스택 소멸:** 일정 시간(예: 3초) 내에 다음 스킬을 명중시키지 못하거나, 적에게 피격당하면 모든 스택이 즉시 0으로 초기화된다.
    *   **보상:** `Flow.Stack` 스택 수에 비례하여 다음과 같은 보상이 `STAT` 시스템을 통해 실시간으로 적용된다.
        *   `1~2 스택`: 쿨다운 감소 5%
        *   `3~4 스택`: 쿨다운 감소 10%, 공격 속도 증가 5%
        *   `5 스택`: 쿨다운 감소 20%, 공격 속도 증가 10%, 모든 공격에 추가 연쇄 번개 발동.
    *   **피드백:**
        *   **UI:** HUD에 'Flow 게이지'가 표시되어 스택이 쌓일수록 차오른다.
        *   **VFX:** 스택 수에 따라 캐릭터의 손이나 무기에서 발산되는 오라(Aura) 이펙트가 점차 강렬하고 화려해진다.

### **3.2 연쇄의 발견: ‘상호작용 태그’ 기반 미니 시너지**

*   **기획 의도 (Why):** 플레이어가 시스템의 규칙을 스스로 '발견'하고 '실험'하며 조합의 재미를 느끼게 한다. "A 다음에 B를 쓰면 어떻게 될까?"라는 호기심을 자극하고, 성공 시 지적인 만족감을 제공한다.
*   **구현 명세 (What & How):**
    *   **태그 쌍 정의:** 모든 스킬/아이템 효과는 '원인'과 '결과' 태그를 가질 수 있다.
        *   **원인(Emit) 태그:** 상태를 부여하는 태그. (예: `Emit.Condition.Freeze`, `Emit.Condition.Wet`)
        *   **결과(Trigger) 태그:** 특정 상태에서 추가 효과를 발동시키는 태그. (예: `Trigger.OnCondition.Shatter`, `Trigger.OnCondition.Electrocute`)
    *   **시너지 판정:** `SKIL` 시스템은 공격 판정 시, 공격 대상이 보유한 '원인' 태그와 공격 스킬이 가진 '결과' 태그가 서로 매칭되는지 검사한다.
    *   **시너지 예시:**
        *   `Emit.Condition.Freeze` (빙결) 상태인 적에게 `Trigger.OnCondition.Shatter` (산산조각) 스킬을 명중시키면, 적이 산산조각나며 주변에 광역 피해를 입힌다.
        *   `Emit.Condition.Wet` (젖음) 상태인 적에게 `Emit.Condition.Freeze` (빙결) 스킬을 사용하면, 빙결 지속시간이 2배로 증가한다.
        *   `Emit.Condition.Wet` (젖음) 상태인 적에게 `Trigger.OnCondition.Electrocute` (감전) 스킬을 명중시키면, 전기가 주변의 다른 '젖은' 적들에게 연쇄적으로 뻗어나간다.

### **3.3 역전의 한 방: 축적형 ‘시그니처 무브’**

*   **기획 의도 (Why):** 플레이어에게 전투 중 명확한 단기 목표를 제시하고, 이를 달성했을 때 압도적인 보상을 제공하여 전투의 클라이맥스를 스스로 만들게 한다.
*   **구현 명세 (What & How):**
    *   **자원 축적:** 전투 중 특정 조건(데이터 테이블로 정의)을 충족할 때마다 '시그니처 차지'(`Signature.Charge.Stack`)라는 특수 자원이 축적된다.
        *   **축적 조건 예시:** `헤드샷 성공`, `패링(Parry) 성공`, `50 콤보 달성`, `정예 몬스터 처치` 등.
    *   **해방 조건:** '시그니처 차지'가 최대치에 도달하면, 캐릭터에게 `Ability.CanUnleash.SignatureMove` 태그가 부여된다.
    *   **피드백:**
        *   **UI:** HUD의 '시그니처 오브'가 완전히 채워지며 불타오른다.
        *   **VFX/SFX:** 캐릭터의 몸에서 강력한 기운이 느껴지는 오라가 발산되며, "준비 완료"를 알리는 효과음이 재생된다.
    *   **실행:** 플레이어가 전용 키(예: X키)를 누르면, `SKIL` 시스템이 태그를 확인하고 해당 캐릭터/직업에 맞는 강력한 '시그-니처 무브'를 발동시킨다. (예: 전사 - 광역 지진 강타, 마법사 - 거대 운석 낙하). 사용 후 자원은 초기화된다.


## **3.4 창조의 완성: 동적 세트 시너지 (Dynamic Set Synergy)**

### **3.4.1 시스템 정의 (What is it?)**
'동적 세트 시너지'는 미리 정해진 '세트 아이템'을 모으는 전통적인 방식이 아닌, 플레이어가 장착한 **모든 아이템, 스킬, 현재 상태(버프 등)가 가진 태그(Tag)들의 조합을 실시간으로 평가**하여, 그 조합의 컨셉과 깊이에 따라 강력한 보너스 효과를 부여하는 시스템이다.

**핵심:** **플레이어의 '빌드(Build)' 그 자체가 곧 '세트 효과'가 된다.**

### **3.4.2 시스템의 역할 (What is its role?)**
*   **개발 방식의 전환:** 디자이너는 '아이템 세트'라는 결과물을 직접 만들지 않는다. 대신 "어떤 태그 조합이 시너지를 내는가?"라는 **'시너지 규칙'**을 설계한다. 이 방식은 고정된 아이템 조합의 한계를 없애고, 모든 아이템과 스킬이 잠재적인 시너지의 재료가 되게 한다.
*   **플레이 경험의 창조:** 플레이어는 정해진 답을 찾는 것이 아니라, 수많은 아이템과 스킬의 태그를 보며 자신만의 빌드를 **'창조'**하고, 숨겨진 태그 조합을 **'발견'**하는 재미를 느낀다. 이는 최고의 자유도와 성취감을 제공한다.

### **3.4.3 구현 및 적용 방법 (How does it work?)**
1.  **태그 수집:** 시스템은 현재 캐릭터가 장착한 모든 장비, 활성화된 스킬, 적용 중인 버프에서 **모든 게임플레이 태그의 합집합**을 실시간으로 수집한다.
2.  **규칙 기반 평가:** `DT_SynergyGroupRules` 데이터 테이블에 정의된 규칙에 따라 수집된 태그들을 평가하여 **'시너지 점수'**를 계산한다.
    *   **규칙 예시:**
        *   **태그 그룹핑:** 특정 태그들을 하나의 그룹으로 묶는다. (예: `G1: FireDOT` 그룹 = `Damage.Fire`, `Effect.Dot.Fire` 태그)
        *   **가중치:** 그룹별로 중요도(가중치)를 설정한다.
        *   **중복 감소:** 동일 그룹의 태그가 여러 개일 경우, 기여도를 점차 감소시킨다. (1.0, 0.6, 0.3...)
        *   **크로스 보너스:** 여러 그룹을 동시에 만족시켰을 때 추가 점수를 부여한다.
3.  **레벨 변환:** 계산된 최종 '시너지 점수'를 정해진 기준에 따라 **'시너지 레벨 (1~3)'**로 변환한다.
4.  **효과 부여:** 달성한 레벨에 맞는 `Set.Bonus.LvX` 태그를 캐릭터에게 부여한다. `STAT` 시스템은 이 태그를 감지하여 데이터 에셋에 정의된 강력한 보너스 스탯(피해량 증가, 쿨다운 감소 등)을 캐릭터에게 적용한다.
5.  **비동기 처리:** 이 모든 계산 과정은 `Z1` 원칙에 따라 비동기 및 프레임 분산 처리되어 게임 성능에 영향을 주지 않는다.

### **3.4.4 디자이너 활용 예시 (Designer's Workflow)**
**목표:** '독과 출혈을 이용한 암살자' 컨셉의 시너지를 만들고 싶다.

1.  **규칙 설계 (in `DT_SynergyGroupRules`):**
    *   `Poison 그룹`: `Effect.Poison`, `Effect.Dot.Poison` 태그 포함, 가중치 1.0
    *   `Bleed 그룹`: `Effect.Bleed.*` 태그 포함, 가중치 1.0
    *   `Backstab 그룹`: `Exploit.Backstab.*` 태그 포함, 가중치 1.2
    *   **크로스 보너스:** `Poison`과 `Backstab` 그룹을 함께 만족하면 +0.5점 추가.
2.  **개별 아이템/스킬 제작:**
    *   '독 바른 단검' 아이템에 `Effect.Poison` 태그 추가.
    *   '과다출혈' 스킬에 `Effect.Bleed.Apply` 태그 추가.
    *   '그림자 습격' 스킬에 `Exploit.Backstab.Window` 태그 추가.
3.  **밸런싱:** 디자이너는 플레이어들의 데이터를 보고 '독' 시너지가 너무 강력하다고 판단되면, 코드 수정 없이 데이터 테이블에서 `Poison 그룹`의 가중치를 0.9로 낮추기만 하면 된다.

### **3.4.5 플레이어 경험 예시 (Player's Experience)**
**상황:** 플레이어가 '독 바른 단검'(`Effect.Poison`)과 '과다출혈' 스킬(`Effect.Bleed.Apply`)을 사용 중이다.

1.  **[관찰]** 플레이어는 캐릭터 정보창에서 자신의 '시너지 레벨'이 1임을 확인한다. (Poison 그룹 1점 + Bleed 그룹 1점 = 2.0점 → Lv1 달성)
2.  **[발견]** 사냥 중 `Exploit.Backstab.Window` 태그가 붙은 '그림자 망토'를 우연히 획득한다.
3.  **[가설]** "이것도 뭔가 시너지에 도움이 되지 않을까?" 라는 생각에 망토를 장착한다.
4.  **[결과]** 망토를 장착하는 순간, '시너지 레벨'이 2로 상승하며 캐릭터가 더 강해지는 것을 확인한다. (`Poison`, `Bleed`, `Backstab` 그룹을 모두 만족하여 크로스 보너스까지 받아 점수가 크게 오름)
5.  **[성취감]** 플레이어는 정해진 공식을 따른 것이 아니라, **스스로의 발견과 조합**을 통해 캐릭터를 성장시켰다는 사실에 큰 만족감과 재미를 느낀다. 이후, `Poison`, `Bleed`, `Backstab` 태그가 붙은 다른 아이템과 스킬을 적극적으로 찾아다니며 자신만의 '독-출혈 암살자' 빌드를 완성해나간다.


#### **3.5 전략적 카운터플레이: 보스 패턴 무력화 및 보상**

*   **기획 의도 (Why):** 플레이어가 보스의 위협적인 패턴을 정확한 스킬로 파훼했을 때, 단순한 생존을 넘어 짜릿한 '역전의 기회'를 제공한다. 이는 시스템에 대한 깊은 이해와 숙련된 조작이 강력한 보상으로 이어진다는 핵심 경험 철학을 실현하는 장치이다.

*   **구현 명세 (What & How):**
    *   **트리거 조건 (Trigger Condition):**
        *   보스는 특정 패턴(예: 광역 폭발) 시전 시, 자신에게 `State.Vulnerable.To.Counter.Wet`과 같은 '약점 상태' 태그를 일시적으로 보유한다.
        *   플레이어의 스킬이 보스에게 부여하는 `Emit.Condition.Wet` 태그와 보스의 약점 태그가 일치하면 '전략적 카운터'가 성공한 것으로 판정된다.

    *   **보스 페널티 (Boss Penalty):**
        *   카운터 성공 시, 보스는 즉시 스킬 시전을 멈추고 `State.Groggy` 태그를 획득하며 약 5초간 그로기 상태에 빠진다.

    *   **플레이어 보상 (Player Rewards):**
        *   **[자원 회복]** 카운터에 성공한 플레이어는 **최대 자원(마나)의 30%**를 즉시 회복한다. (`STAT` 시스템 연동)
        *   **[쿨다운 초기화]** 현재 재사용 대기시간이 적용 중인 스킬 중 **1개를 무작위로 선택**하여 쿨타임을 즉시 초기화한다. (`SKIL` 시스템 연동)
        *   **[특별 보상 드랍]** 그로기 상태에 빠진 보스가 몸에서 **소량의 희귀 제작 재료 또는 강화 아이템**을 바닥에 떨어뜨린다. 플레이어는 공격을 포기하고 아이템을 줍거나, 극딜을 이어가는 등 짧은 순간 전략적 선택을 해야 한다. (`ITEM` 시스템 연동)

    *   **피드백 (Feedback):**
        *   **VFX/SFX:** 카운터 성공 시, 유리 깨지는 듯한 효과음과 함께 보스의 패턴이 무력화되는 명확한 시각 효과가 출력된다.
        *   **UI:** 쿨다운이 초기화된 스킬 아이콘이 화면 중앙에 잠시 표시되어 플레이어가 즉시 인지할 수 있도록 돕는다.

---


### **3.6 핵심 기능 확장: 과부하(Overload) 시스템**

#### **3.6.1 기획 의도 (Why)**
(기존과 동일) 플레이어에게 '하이리스크-하이리턴'의 명확한 선택지를 제공하여, 결정적인 순간에 모든 것을 쏟아붓는 짜릿한 경험을 선사한다.

#### **3.6.2 시스템 개요 (What & How)**
'과부하'는 플레이어가 의도적으로 자신에게 강력한 버프와 페널티를 동시에 부여하는 특수 상태이다. 이 능력은 `DOC-SKIL-GDD-MAIN`에서 정의한 '조합형 커스텀 스킬' 시스템을 통해 **플레이어가 직접 제작하는 스킬**의 형태로 제공된다. 플레이어는 **'과부하 코어 팩'**을 기반으로 `메인 룬`과 `옵션 파츠`를 조합하여 자신만의 과부하 스킬을 만들고, 스킬 슬롯에 단 하나만 장착하여 사용할 수 있다.

#### **3.6.3 데이터 구조 및 역할 분담 (Data Structure & Role Segregation)**
과부하의 구체적인 속성은 SKIL 시스템에서 조합되고, STAT 시스템은 그 결과를 받아 처리하는 '서비스' 역할에 집중한다.

*   **SKIL 시스템의 역할 (데이터 조합 및 요청):**
    *   **`과부하 코어 팩`:** 스킬의 기본 틀과 `메인 룬`, `옵션 파츠`를 장착할 슬롯의 수를 결정한다.
    *   **`메인 룬` (과부하용):** 과부하의 핵심적인 리스크와 보상을 정의한다. (예: `CostType` - 랜덤 자원 소모, `Penalty_DamageTakenMultiplier` - 받는 피해 증가량, `BaseDuration` - 기본 지속시간)
    *   **`옵션 파츠` (과부하용):** 부가적인 능력치나 편의성을 더한다. (예: `Duration +1.5s`, `CritChance +20%`, `Cooldown -10%`)
    *   **스킬 제작 시,** SKIL 시스템은 이 모든 파츠의 데이터를 종합하여 **`FOverloadParameters`** 라는 단일 구조체로 만들어 해당 스킬에 저장한다.

*   **STAT 시스템의 역할 (데이터 수신 및 처리):**
    *   STAT 시스템은 `SKIL` 시스템으로부터 **`FOverloadParameters`** 구조체를 전달받아 실제 상태 변화를 처리한다. 이 구조체는 STAT 시스템이 과부하를 처리하는 데 필요한 모든 정보를 담고 있다.

*   **`FOverloadParameters` 구조체 정의 (SKIL -> STAT 전달용 데이터):**
    ```cpp
    USTRUCT(BlueprintType)
    struct FOverloadParameters
    {
        GENERATED_BODY()

        // 비용 관련
        UPROPERTY() EOverloadCostType CostType;          // 체력, 마나, 또는 랜덤
        UPROPERTY() float CostMinPercent;                // 최소 비용 (%)
        UPROPERTY() float CostMaxPercent;                // 최대 비용 (%)

        // 효과 관련
        UPROPERTY() float Duration;                      // 총 지속시간
        UPROPERTY() TMap<FGameplayTag, float> StatModifiers; // 강화될 스탯과 배율

        // 페널티 관련
        UPROPERTY() float DamageTakenMultiplier;         // 받는 피해량 배율
        UPROPERTY() TObjectPtr<DA_DebuffProfile> BurnoutDebuffProfile; // 번아웃 디버프 에셋
    };
    ```

#### **3.6.4 실행 파이프라인 (Revised)**
1.  **스킬 발동:** 플레이어가 스킬 슬롯에 장착된 '과부하 스킬'을 사용한다.
2.  **SKIL 시스템 처리:**
    *   해당 스킬의 `ExecutionLogic`이 실행된다.
    *   `ExecutionLogic`은 스킬에 저장된 **`FOverloadParameters`** 데이터를 가져온다.
    *   `STAT` 시스템의 인터페이스인 **`I_STAT_Overloadable_If::RequestOverload(const FOverloadParameters& InParams)`** 를 호출하여 파라미터를 전달한다.
3.  **STAT 시스템 처리 (이후 파이프라인은 기존과 동일):**
    *   `RequestOverload` 함수가 호출되면, `InParams`의 데이터를 기반으로 비용을 계산하고 소모시킨다.
    *   성공 시, 플레이어에게 `State.Buff.Overload` 태그를 부여하고 `StatModifiers`와 페널티를 적용한다.
    *   지정된 `Duration`이 지나면 모든 효과를 제거하고, `BurnoutDebuffProfile`에 명시된 번아웃 디버프를 적용한다.

#### **3.6.5 시스템 연동 (Revised)**
*   **SKIL 시스템 (주관 시스템):**
    *   **과부하 능력의 주체.** '과부하 코어 팩' 및 관련 파츠의 데이터 에셋을 관리한다.
    *   플레이어의 스킬 제작 로직을 통해 과부하 스킬의 최종 파라미터를 결정한다.
    *   스킬 사용 시, `STAT` 시스템에 과부하 상태 적용을 '요청'하는 역할을 한다.

*   **STAT 시스템 (서비스 시스템):**
    *   **과부하 상태의 실제 처리자.** SKIL 시스템의 요청을 받아 안정적으로 스탯을 변경하고, 타이머를 관리하며, 상태를 원래대로 복구시키는 책임을 진다.
    *   `I_STAT_Overloadable_If` 인터페이스를 제공하여 SKIL 시스템과의 결합도를 최소화한다.

*   **ITEM 시스템 (보조 시스템):**
    *   플레이어의 과부하 스킬을 간접적으로 강화하는 역할을 한다.
    *   "과부하 스킬의 쿨다운 -10%", "과부하 스킬의 자원 소모량 -15%" 와 같은 옵션을 아이템에 부여하여, 스킬 빌드와의 시너지를 창출한다.

---

### **3.7 핵심 기능 확장: 유물(Relic) & 저주(Curse) 시스템**

#### **3.7.1 기획 의도 (Why)**
단순한 스탯 증가를 넘어, 아이템이 플레이어의 '게임 규칙' 자체를 바꾸는 경험을 제공한다. 이는 아이템 파밍의 목표를 다각화하고, 플레이어가 자신만의 독특한 페널티와 강점을 가진 하이리스크-하이리턴 빌드를 창조하게 만든다.

#### **3.7.2 시스템 개요 (What & How)**
'유물'은 새로운 아이템 카테고리로, **'유물 전용 슬롯'에 단 하나만 장착**할 수 있는 매우 강력한 아이템이다. 유물은 획기적인 패시브 효과를 제공하며, 선택적으로 강력한 '저주(페널티)'를 동반할 수 있다.

#### **3.7.3 데이터 구조 (`DA_Item` 확장)**
`DA_Item` 데이터 에셋에 `EItemCategory::Relic` 타입을 추가하고, 아래와 같은 유물 전용 속성들을 정의한다.

| 프로퍼티 명 | 데이터 타입 | 설명 (디자이너 조정 가능) |
| :--- | :--- | :--- |
| `ItemCategory` | `Enum` | `EItemCategory::Relic`으로 설정 |
| **`RelicEffectLogic`** | `TSubclassOf<URelicEffectLogic>` | 유물의 핵심 패시브 로직을 담은 UObject. BP로 기능 확장. |
| **`bHasCurse`** | `bool` | 이 유물에 저주가 있는지 여부를 디자이너가 체크. |
| **`CurseStatTag`**| `FGameplayTag`| 저주가 적용될 스탯의 태그. (`bHasCurse`가 true일 때만 활성화) |
| **`CurseStatValue`** | `float` | 저주로 인해 변경될 스탯 값. (예: `-30.0` 또는 `0.5`) |
| **`CurseStatOp`** | `Enum` | 저주가 스탯에 적용되는 방식. (Add, Multiply 등) |
| `AuraVFX` | `TSoftObjectPtr<UNiagaraSystem>`| 장착 시 캐릭터에게 표시될 고유의 오라 효과. |

#### **3.7.4 실행 파이프라인**
1.  **장착:** 플레이어가 유물을 '유물 전용 슬롯'에 장착한다.
2.  **`USITEM_ItemComponent` 처리:**
    *   `RelicEffectLogic`에 지정된 클래스의 인스턴스를 생성하고 활성화하여, 유물의 고유 패시브 효과(예: '대시 시 주변 적 느려짐')를 시작시킨다.
    *   `bHasCurse`가 true이면, `CurseStatTag`와 `CurseStatValue`, `CurseStatOp`을 하나의 '모디파이어'로 묶는다.
    *   `STAT` 시스템의 인터페이스(`I_STAT_Buffable_If::ApplyModifier`)를 호출하여, **`Source.Relic`** 이라는 출처 정보와 함께 저주 모디파이어를 캐릭터에게 적용시킨다.
    *   캐릭터 액터에게 `RELIC_OnEquipped_E` 이벤트를 전파하여 `AuraVFX`를 부착하도록 알린다.
3.  **해제:** 장착 해제 시, 생성했던 `RelicEffectLogic` 인스턴스를 파괴하고 `STAT` 시스템에서 저주 모디파이어를 제거하며, 오라 VFX를 소멸시킨다.

#### **3.7.5 시스템 연동**
*   **STAT 시스템:** `ITEM` 시스템으로부터 '저주' 스탯 모디파이어를 전달받아 캐릭터에게 적용한다. '지능형 스탯 정보 표시 시스템'의 일부로서, 이 스탯이 '유물'에서 비롯되었음을 인지하고 UI ViewModel에 정보를 제공한다.
*   **UI 시스템:**
    *   '유물 전용 슬롯' UI를 추가한다.
    *   캐릭터 정보창에 **'활성화된 유물 효과'** 섹션을 추가하여 `RelicEffectLogic`의 설명과 **'적용 중인 저주'** 섹션을 추가하여 `CurseStatTag`의 구체적인 페널티를 명확히 분리하여 표시한다. (지능형 스탯 정보 표시 시스템 연동)

#### **3.7.6 획득 경로**
*   우선 월드 보스 처치 시 낮은 확률로 드랍되는 것으로 한정한다. (추후 확장 가능)
---

### **3.8. 핵심 기능 확장: 스킬 융합(Skill Fusion) 시스템**

#### **3.8.1 기획 의도 (Why)**
'연쇄의 발견'이라는 핵심 전투 재미 요소를 극대화한다. 플레이어가 정해진 스킬을 순서대로 사용하는 것을 넘어, 전투 상황과 환경에 맞춰 스킬을 창의적으로 조합하여 숨겨진 강력한 제3의 효과를 '창조'하는 지적 유희와 성취감을 제공하는 것을 목표로 한다.

#### **3.8.2 시스템 개요 (What & How)**
플레이어가 사용하는 스킬은 `융합 베이스(Base)` 또는 `융합 트리거(Trigger)`의 속성을 가질 수 있다. 특정 `베이스` 조건이 형성된 상태에서 `트리거` 스킬을 사용하면, 두 스킬의 태그 조합에 따라 예측하지 못한 강력한 '융합 효과'가 발동된다. 모든 스킬은 잠재적으로 `베이스` 또는 `트리거`의 재료가 될 수 있다.

#### **3.8.3 융합의 발동 방식 (Fusion Trigger Mechanism)**
융합의 첫 번째 조건인 `베이스`는 두 가지 형태로 생성된다.

*   **잔류 효과 영역 (Lingering Zone - 장판):** 특정 스킬이 지형이나 구조물에 적중 시, `Fusion.Base.Fire`와 같은 태그를 가진 '장판'을 생성한다.
*   **지속 효과 상태 (Lingering Status - 디버프):** 특정 스킬이 액터(캐릭터, 몬스터)에게 적중 시, 해당 액터에게 `Fusion.Base.Wet`과 같은 태그를 가진 '지속 상태'를 부여한다.
*   **광역 스킬의 경우:** 광역 스킬이 지형과 액터에게 동시에 적중하면, '장판'과 '지속 상태'가 동시에 생성될 수 있다.

#### **3.8.4 성능 최적화: '융합 가능 영역' 관리 (Technical Solution for Performance)**
**문제:** "수많은 '장판'과 '투사체'가 난무하는 환경에서 모든 상호작용을 검사하면 심각한 성능 저하가 발생한다."

**해결책 (`Z1 아키텍처` 준수):**
이를 해결하기 위해, 모든 상호작용을 실시간으로 계산하지 않고 **'융합 가능 영역 관리자(Fusion Volume Manager)'** 서브시스템을 도입한다.

1.  **영역 등록:** '장판'이 생성될 때, 해당 위치에 보이지 않는 **`USphereComponent` (융합 볼륨)**를 함께 생성하고, 자신의 `Fusion.Base.Fire` 태그를 이 볼륨에 등록한다. 이 볼륨은 **매우 제한된 수(예: 최대 5개)**만 동시에 존재할 수 있으며, 가장 오래된 볼륨부터 자동으로 소멸된다.
2.  **트리거 감지:** '회오리'와 같은 `융합 트리거` 스킬이 발사될 때, 실시간으로 모든 장판을 검사하는 것이 아니라, 이 **`융합 볼륨`과 Overlap(겹침)되는지만**을 검사한다.
3.  **효율성:** 이 방식은 수십 개의 장판 VFX가 있더라도, 실제 물리적 충돌 검사는 소수의 `USphereComponent`와만 이루어지므로 연산 부하를 최소화하며, `Z1: 비동기+프레임 분산` 원칙에 따라 처리하여 프레임 드랍을 원천적으로 방지한다.

#### **3.8.5 융합 규칙의 정의 (Defining Fusion Rules)**
*   모든 융합 규칙은 **`DT_SkillFusionRules`** 데이터 테이블에 의해 중앙 관리된다.
*   **구조:**
    *   `FusionBaseTag (FGameplayTag)`: 융합의 기반이 되는 태그 (예: `Fusion.Base.Fire`)
    *   `FusionTriggerTag (FGameplayTag)`: 융합을 발동시키는 스킬의 태그 (예: `Skill.Tornado`)
    *   `Result_ExecutionLogic (TSubclassOf<USkillExecutionLogic>)`: 융합 시 실행될 새로운 행동 로직 (예: `BP_Exec_FireTornado`)
    *   `Result_StatModifiers (TArray<FStatModifier>)`: 추가적으로 적용될 스탯 변화

#### **3.8.6 플레이어 발견 및 피드백 (Discovery & Feedback)**
*   **융합 힌트:** 플레이어가 장착한 스킬 슬롯에서, `DT_SkillFusionRules`에 따라 서로 융합이 가능한 스킬들이 있다면 **동일한 색상의 테두리나 작은 아이콘**이 표시되어 잠재적인 조합 가능성을 시각적으로 알려준다.
*   **실행 피드백:** 융합 성공 시, 일반 스킬과는 확연히 다른 강력한 시각/청각적 효과가 발생하여 플레이어가 성공을 즉시 인지하고 성취감을 느끼게 한다.

#### **3.8.7 비용 및 재사용 대기시간 (Cost & Cooldown)**
*   융합은 '보너스' 개념으로, 별도의 추가 비용이나 추가 쿨다운이 없다.
*   융합을 발동시킨 `트리거` 스킬(예: 회오리)의 기본 자원 소모와 재사용 대기시간만이 정상적으로 적용된다.

#### **3.8.8 시스템의 한계와 확장성 (Limitations & Scalability)**
*   **확장성:** 이론적으로 모든 스킬은 `DA_Skill` 데이터 에셋에 `FusionBaseTag` 또는 `FusionTriggerTag`를 추가하는 것만으로 융합의 재료가 될 수 있다. 디자이너는 `DT_SkillFusionRules` 데이터 테이블을 편집하는 것만으로 코드 수정 없이 새로운 융합 조합을 무한정 추가할 수 있다.

### **3.8.9 융합 증폭 시스템: 집중 사격 (Fusion Amplification: Focused Fire)**

#### **3.8.9.1 기획 의도 (Why)**
단순히 두 스킬을 섞는 것을 넘어, 플레이어의 지속적인 노력과 정밀한 조준이 융합의 파괴력을 극적으로 증폭시키는 메커니즘을 추가한다. 이는 플레이어에게 "작은 성공을 쌓아 폭발시키는" 명확한 전투 목표와 클라이맥스의 경험을 제공한다.

#### **3.8.9.2 시스템 개요 (What & How)**
플레이어가 특정 지점(지형) 또는 단일 대상(적)에게 지속적으로 피해를 누적시키면, 해당 위치/대상에 **'융합 에너지'**가 쌓인다. 최대치까지 충전된 '융합 에너지'는 **'융합 증폭 상태'**로 전환되어, 이후 발생하는 스킬 융합의 효과를 극대화시킨다.

#### **3.8.9.3 실행 파이프라인**
1.  **에너지 누적:**
    *   **[지형]** 플레이어의 공격이 좁은 반경 내의 특정 지점에 반복적으로 적중할 때마다, 해당 위치에 `Fusion.Charge.Stack` 태그 카운트가 누적된다.
    *   **[대상]** 플레이어의 공격이 단일 대상에게 반복적으로 적중할 때마다, 해당 대상에게 `Fusion.Charge.Stack` 태그 카운트가 누적된다.
    *   (기술적 구현: `STAT` 시스템이 `ApplyDamage` 인터페이스 호출 시, `CauseTag`에 `Skill.Projectile`과 같은 태그를 기반으로 피격 위치/대상을 추적하고 스택을 관리한다.)

2.  **증폭 상태 전환:**
    *   `Fusion.Charge.Stack`이 데이터 테이블에 정의된 최대치(예: 10스택)에 도달하면, 기존 스택 태그는 사라지고 **`Fusion.State.Amplified`** 라는 새로운 상태 태그가 부여된다.
    *   **피드백 (지형):** 해당 위치에 희미하게 빛나는 마법진 형태의 **VFX(증폭 영역)**가 나타나며, 이 영역은 기존 '잔류 효과 영역'보다 약간 더 넓고 오래 지속된다.
    *   **피드백 (대상):** 해당 대상의 몸에 금이가며 빛나는 듯한 **VFX**가 나타난다.

3.  **융합 증폭 실행:**
    *   **시나리오:** '화염 장판'(`Fusion.Base.Fire`)이 깔린 곳이 '증폭 상태'(`Fusion.State.Amplified`)일 때, '회오리'(`FusionTriggerTag: Skill.Tornado`) 스킬이 해당 영역을 지나간다.
    *   **규칙 조회:** 시스템은 `DT_SkillFusionRules` 데이터 테이블에서 '화염 + 회오리' 조합을 찾는다.
    *   **증폭 효과 적용:** 테이블에는 일반 융합 결과(`BP_Exec_FireTornado`)와 함께, **증폭된 융합 결과(`BP_Exec_FireTornado_Amplified`)**가 추가로 정의되어 있다. 시스템은 `Fusion.State.Amplified` 태그의 존재를 확인하고, 증폭된 `ExecutionLogic`을 실행시킨다.
    *   **결과:** 일반 '화염 회오리'가 아닌, 훨씬 더 크고 강력하며 **추가적인 폭발 효과를 동반하는 '대화염 폭풍'**이 시전된다. 캐릭터에게 적용된 경우, 훨씬 더 큰 데미지를 입힌다.

#### **3.8.9.4 시스템 연동**
*   **STAT 시스템:** `ApplyDamage` 요청을 처리할 때, 피격 정보를 바탕으로 '융합 에너지' 스택을 계산하고 관리하는 핵심적인 역할을 담당한다.
*   **SKIL 시스템:** `STAT` 시스템으로부터 부여된 `Fusion.State.Amplified` 태그를 감지하고, `DT_SkillFusionRules`를 참조하여 일반 융합을 할지, 증폭된 융합을 할지 최종적으로 결정하고 실행한다.

---

`DOC-GAMEPLAY-FUNFACTORS` 문서 작성을 완료했습니다. 이 문서를 `마스터 문서 등록부`에 추가하고, 이제 `STAT`, `ITEM`, `SKIL` 시스템의 모든 기획/개발은 이 문서에 정의된 3가지 핵심 재미 요소를 구현하고 강화하는 방향으로 진행되어야 합니다.
