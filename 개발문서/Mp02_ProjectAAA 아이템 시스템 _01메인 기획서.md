### **`DOC-ITEM-GDD-MAIN` (v1.5 - Final-Master)**

# **ProjectAAA: 아이템 시스템 메인 기획서 (v1.5 - 최종 마스터)**

## **1. 문서 개요**

| 항목 | 내용 |
| :--- | :--- |
| **문서 ID** | DOC-ITEM-GDD-MAIN |
| **문서명** | 아이템 시스템 메인 기획서 (Item System Game Design Document) |
| **버전** | **1.5 (Final & Approved)** |
| **담당자** | PM/AI |
| **목적** | 아이템의 생성, 성장, 검색 및 UI 연동을 포함한 모든 기획적 요구사항을 최종 정의한다. 이 문서는 MGI의 모든 아키텍처 원칙을 준수한다. |
| **변경 이력**| **v1.5:** MGI 아키텍처 원칙(플러그인화, 이벤트 중계, 비동기 의무) 명시. 최종 마스터 버전. |
| | v1.4: '6.5 아이템 생명주기 피드백' 추가. |
| | **v1.3:** '7. 인벤토리 분류 및 검색: 태그 쿼리 시스템' 추가. |
| | **v1.2:** 랜덤 옵션, 에고 아이템 성장/진화 시스템, UI/UX 개선안 등 대규모 업데이트. |
| | **v1.1:** '6. UI 연동 및 표시 명세' 섹션 추가. |

## **2. 시스템 개요 및 비전**


### **2.1 시스템 정의**
'아이템 시스템'은 플레이어가 획득하고 사용하는 모든 아이템의 데이터, 로직, 생명주기를 관리하는 **독립된 기능 모듈**입니다. 이는 캐릭터 커스터마이징의 핵심이며, STAT 및 SKIL 시스템과 유기적으로 연동하여 플레이어의 전략적 선택을 지원합니다.

### **2.2 설계 비전**
> **"모든 아이템은 독립된 데이터 조각이며, 플레이어의 전략과 기대를 담는 그릇이다."**

>아이템 시스템은 플레이어가 자신의 캐릭터를 커스터마이징하고, 전투 전략을 구체화하며, 성장의 재미를 느끼게 하는 가장 직접적인 매개체이다. 본 시스템은 **'예측 가능한 성장'**과 **'기대되는 무작위성'**의 조화를 통해, 플레이어에게 아이템 획득과 성장의 모든 과정에서 지속적인 즐거움을 제공하는 것을 목표로 한다.


### **2.3 상위 아키텍처 원칙 (Overarching Architectural Principles)**
본 시스템은 ProjectAAA의 최상위 개발 지침(MGI)을 절대적으로 준수하며, 다음 원칙에 따라 설계 및 구현되어야 한다.

*   **아키텍처 원칙 (A1/Z2 준수):** ITEM 시스템은 독립적인 **Game Feature Plugin**으로 제공하며, 엔진 코어 및 다른 플러그인과의 C++ 레벨 강결합을 금지한다.
*   **이벤트 중계 (G00_1/G00_2 준수):** `USITEM_ItemComponent`에서 발생하는 모든 `ITEM_*` 이벤트 디스패처는 반드시 중앙 허브인 **`BP_InteractionHub`**를 통해 중계되어, 다른 시스템이 안전하게 구독할 수 있도록 해야 한다.
*   **성능 규칙 (Z1 준수):** 대규모 인벤토리 정렬, 다수 아이템 일괄 처리, 대량 루팅으로 인한 동시 이펙트 발생 등 단일 프레임에 심각한 부하를 유발할 수 있는 모든 로직은 **`Z1: 비동기+프레임 분산` 아키텍처를 의무적으로 적용**하여 처리해야 한다.

## **3. 아이템 생성 규칙: 랜덤성과 깊이**

아이템이 게임 세계에 생성(드롭, 제작, 보상)될 때, 그 속성은 데이터에 정의된 규칙에 따라 동적으로 결정된다.

### **3.1 아이템 옵션 리스트: 가중치 기반 랜덤 추출**
-   **옵션 풀 (Option Pool):** `DT_OptionPool` 데이터 테이블에는 `주 옵션`, `보조 옵션` 등 그룹별로 가능한 모든 스탯 옵션(스탯 태그)과 각 옵션의 **개별 등장 가중치**가 정의된다.
-   **옵션 개수:** 아이템의 등급이나 레벨에 따라 부여되는 옵션의 개수는 **커브(`CurveFloat`)** 데이터로 결정된다. (예: `전설` 등급 아이템은 주 옵션 3개, 보조 옵션 3개를 가진다.)
-   **생성 프로세스:** 아이템 생성 시, 시스템은 해당 아이템 등급에 맞는 옵션 개수를 커브에서 가져온 뒤, 옵션 풀에서 가중치를 기반으로 실제 옵션들을 랜덤하게 추출하여 부여한다.

### **3.2 아이템 옵션 값: 예측 가능한 변동성**
-   **값 결정:** 각 옵션의 수치는 고정값이 아닌, 범위 내에서 랜덤하게 결정된다.
-   **공식:** `최종 값 = 기본값(커브) * (1 + Random.Range(최소편차%, 최대편차%))`
-   **예시:** `DA_Item_FireSword`의 기본 공격력 값이 100이고 편차가 -10% ~ +10%라면, 생성되는 아이템의 실제 공격력은 90~110 사이의 값을 가지게 된다.

## **4. 아이템 성장 시스템: 일반과 에고(Ego)**

모든 아이템은 '일반 아이템'과 '에고 아이템'으로 구분된다.

### **4.1 일반 아이템 (Normal Items)**
-   **특징:** 성장이 불가능. 획득 시 모든 옵션과 값이 결정되며, 주로 플레이어의 초중반 성장을 돕거나 에고 아이템의 '먹이'로 사용된다.

### **4.2 에고 아이템 (Ego Items)**
-   **특징:** 성장이 가능한 특별한 아이템. 경험치(EXP)와 레벨 개념을 가진다.
-   **획득:** 희귀 드랍, 퀘스트, 제작 등 특별한 경로로만 획득 가능하다.
-   **데이터 구조:** `DA_Item` 에셋에 `bIsEgoItem(bool)` 플래그로 구분되며, `EgoGrowthCurve`, `EgoEXPTable` 등 성장 관련 데이터를 추가로 가진다.

#### **4.2.1 에고 아이템 성장: 레벨링 단계 (아이템 포식)**
-   **성장 방식:** 플레이어는 전용 UI를 통해 다른 '일반 아이템'을 에고 아이템에게 '먹이'로 주어 경험치를 획득시킨다.
-   **경험치 획득:** 먹이로 사용된 아이템의 등급/종류에 따라 획득 경험치가 달라진다. (`DT_EgoFeedEXP` 테이블 참조)
-   **레벨 업 효과:** 레벨이 오를 때마다 `EgoGrowthCurve`에 따라 **기본 성능(공격력 등)만** 예측 가능하게 상승한다. 이 단계에서는 랜덤 옵션이 변경되지 않는다.

#### **4.2.2 에고 아이템 성장: 진화 단계 (옵션 재조정)**
-   **진화 조건:** 에고 아이템이 특정 최대 레벨(예: 20)에 도달하고, 필요한 재료를 갖추면 '진화'가 가능하다.
-   **진화 효과:**
    1.  **등급 상승:** 아이템의 등급이 한 단계 상승한다. (예: `희귀` -> `전설`)
    2.  **레벨 초기화:** 레벨이 1로 초기화된다.
    3.  **옵션 완전 재설정 (Re-roll):**
        *   **기존의 모든 랜덤 옵션이 제거된다.**
        *   **새롭게 상승한 등급에 맞는 옵션 풀**에서, 규칙에 따라 **완전히 새로운 옵션들이 랜덤하게 부여된다.** 이는 플레이어에게 강력한 보상과 함께 '반-랜덤 뽑기'의 기대감을 제공한다.

## **5. 편의성 및 확장성**

-   **저장 공간 확장:** '가방', '보관함' 등은 모두 `USITEM_ItemComponent`를 사용하는 독립적인 단위이다. 디자이너는 데이터 및 UI 레벨에서 새로운 저장 공간을 쉽게 추가하고 관리할 수 있다.
-   **데이터 중심 설계:** 본 기획의 모든 규칙(옵션, 성장, 경험치)은 C++ 코드가 아닌 데이터 테이블과 커브 에셋으로 관리되어, 디자이너의 자유로운 수정과 확장을 보장한다.

## **6. UI 연동 및 표시 명세**

### **6.1 UI 연동 아키텍처: MVVM (Model-View-ViewModel)**
아이템 관련 UI 또한 STAT 시스템과 마찬가지로 MVVM 패턴을 절대적으로 준수하여 UI(View)와 게임 로직(Model)을 분리합니다.

*   **Model (모델):** `USITEM_ItemComponent`. 실제 인벤토리 데이터와 로직을 보유.
*   **ViewModel (뷰모델):** `UITEM_InventoryViewModel`. Model의 데이터를 가공하여 View가 사용하기 좋은 형태로 노출.
*   **View (뷰):** `WBP_Inventory`, `WBP_Equipment` 등. ViewModel의 데이터를 바인딩하여 화면에 표시.

### **6.2 핵심 UI 요소 및 ViewModel 속성**
-   **인벤토리/장비 그리드:** `TArray<FUI_ItemSlotInfo>`를 통해 각 슬롯의 아이콘, 스택 수, 등급 테두리 등을 표시.
-   **아이템 툴팁:** `FUI_ItemTooltipInfo` 구조체를 통해 아이템의 상세 정보와 스탯 변화 미리보기(`FUI_StatChangePreview`)를 표시.

### **6.3 핵심 UX 기획**
-   **지능형 슬롯 표시:** 아이템 선택 시 장착 가능한 모든 슬롯의 테두리 색상이 하이라이트된다.
-   **쉬운 장착:** 하이라이트된 슬롯 클릭 시 즉시 장착된다.
-   **캐릭터 상태창 직접 비교:** 아이템 비교 시, 메인 캐릭터 상태창의 스탯 값이 "100 -> **120**"과 같이 역동적으로 변경되어 변화를 직관적으로 보여준다.

### **6.4 UI 업데이트 파이프라인**
-   모든 인벤토리/장비 데이터 변경은 `USITEM_ItemComponent`에서 발생하여 `ITEM_OnInventoryChanged_E`, `ITEM_OnEquipmentChanged_E`와 같은 이벤트를 전파한다.
-   `UITEM_InventoryViewModel`이 이벤트를 수신하여 자신의 데이터를 갱신하면, UMG의 바인딩 시스템을 통해 UI가 자동으로 업데이트된다.

### **6.5 아이템 생명주기 피드백**
플레이어의 행동에 대한 명확한 피드백을 제공하여 경험의 질을 높인다.

-   **획득:** 아이템 획득 시, 화면 우측 하단에 아이템 아이콘과 이름이 표시되는 로그(Toast)가 나타나며, 등급에 따라 차별화된 획득 사운드가 재생된다.
-   **소멸/사용:** 아이템을 소모하거나 '먹이'로 사용할 때, 해당 아이템 아이콘이 사라지는 시각 효과와 함께 적절한 사운드가 재생된다.
-   **진화:** 에고 아이템 진화 성공 시, 화면 전체에 걸친 화려한 시각 효과(VFX)와 웅장한 사운드(SFX)가 재생되어 플레이어의 성취감을 극대화한다.

## **7. 인벤토리 분류 및 검색: 태그 쿼리 시스템**

플레이어의 편의성을 극대화하기 위해 모든 인벤토리의 아이템 분류 및 검색은 **'태그 쿼리 시스템(Tag Query System)'**을 기반으로 동작한다.

### **7.1 시스템 원칙**
> **"데이터는 하나로 관리하고, 태그로 질문하여 답을 얻는다."**

-   `USITEM_ItemComponent`는 단일 데이터 소스를 관리하며, `GetItemsByQuery()` 함수를 통해 외부의 '질문'에 답한다.

### **7.2 쿼리(Query)의 구조**
-   `FItemQuery` 구조체는 `RequiredTags`(AND 조건)와 `ForbiddenTags`(NOT 조건)를 조합하여 복잡한 검색을 가능하게 한다.
-   **예시:** **"화염 속성이면서, 장착 중이 아닌, 검 또는 도끼"** 와 같은 고급 필터링을 지원한다.

---
`DOC-ITEM-GDD-MAIN` 기획서 최종본 작성을 완료했습니다. 이 문서는 `마스터 문서 등록부`에 **'승인'** 상태로 기록되며, 아이템 시스템 개발의 공식적인 청사진이 됩니다.

`프로젝트 대시보드`에 따라, 다음 작업인 **`스킬 시스템 메인 기획서(DOC-SKIL-GDD-MAIN)`** 작성을 시작하겠습니다.